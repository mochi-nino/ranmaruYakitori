import{_ as V,o as c,c as w,J as E,p as j,e as $,a as e,u as F,r as x,f as h,g as J,b as a,w as d,j as y,d as g,i as v,t as D,s as k,y as q,E as A,n as M}from"./entry.78f1c0a1.js";import{u as O}from"./vue.f36acd1f.af229a2c.js";import{b as f}from"./button.93fec5de.js";const T={},Z=o=>(j("data-v-7d5cc6aa"),o=o(),$(),o),H={class:"w-[90%] h-[280px] absolute inset-0 m-auto z-50 bg-gray-500/90"},L=Z(()=>e("h3",{class:"bg-yellow-900 text-3xl text-center py-2"},"訊息",-1));function R(o,t){return c(),w("div",H,[L,E(o.$slots,"default",{},void 0,!0)])}const G=V(T,[["render",R],["__scopeId","data-v-7d5cc6aa"]]);const l=o=>(j("data-v-afb455cb"),o=o(),$(),o),K={class:"my-5 px-5"},Q={key:0,class:"xl:w-[600px] xl:h-[calc(100vh-65px-145px)] mx-auto bg-gray-100 border-2 border-yellow-800 py-5"},W={class:"relative",id:"userImg"},X=["src","alt"],Y=l(()=>e("p",{class:"text-white font-bold"},"更換圖片",-1)),ee=[Y],se=l(()=>e("p",{class:"text-center mt-5 font-bold text-red-400"}," 請輸入含有【.jpg，.jpeg，.png】的圖片網址 ",-1)),te={class:"grid grid-cols-[100px,1fr,60px] mx-auto gap-2 mt-12"},ae=l(()=>e("p",{class:"text-right"},"網址：",-1)),oe={class:"text-center mt-6"},re={class:"grid grid-cols-[100px,1fr] mx-auto gap-2 mb-10 w-[80%]"},le=l(()=>e("p",{class:"text-right"},"姓名：",-1)),ne={class:"grid grid-cols-[100px,1fr] mx-auto gap-2 mb-10 w-[80%]"},de=l(()=>e("p",{class:"text-right"},"電子信箱：",-1)),ce={class:"grid grid-cols-[100px,1fr,60px] mx-auto gap-2 mb-10 w-[80%]"},ue=l(()=>e("p",{class:"text-right"},"密碼：",-1)),ie={class:"grid grid-cols-[100px,1fr,60px] mx-auto gap-2 mb-10 w-[80%]"},pe=l(()=>e("p",{class:"text-right"},"新密碼：",-1)),_e={class:"grid grid-cols-[100px,1fr,60px] mx-auto gap-2 mb-10 w-[80%]"},me=l(()=>e("p",{class:"text-right"},"確認新密碼：",-1)),xe={class:"text-center mt-20"},ge={__name:"userInfo",setup(o){//! ----------宣告引入------------
const t=F();//!  ----------變數------------
const r=x(!0),n=x(!1),_=x(null),u=x("");//!  ----------功能------------
const P=()=>{u.value.length>10&&(_.value=u.value,u.value="",n.value=!n.value)},U=()=>{r.value=!r.value},I=()=>r.value?null:{regex:/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]+$/,required:"required",min:"8",max:"16"},C=h(()=>t.data.userData?t.data.userData:null),B=h(()=>!!t.data.userData),S=h(()=>r.value?"*".repeat(t.data.userData.password.length):null),N=b=>{//! 驗證舊密碼是否相同
b.oldPassword===t.data.userData.password||r.value?fetch(`https://api.escuelajs.co/api/v1/users/${t.data.userData.id}`,{method:"PUT",body:JSON.stringify({email:t.data.userData.email,name:t.data.userData.name,avatar:_.value,password:b.newPassword}),headers:{"Content-Type":"application/json"}}).then(s=>s.json()).then(async s=>{sessionStorage.getItem("userData")?sessionStorage.setItem("userData",JSON.stringify(s)):localStorage.setItem("userData",JSON.stringify(s)),await t.login(s),alert("更改成功"),window.location.reload()}).catch(s=>{console.log(s)}):alert("舊密碼錯誤")};return O({title:"蘭丸燒烤 | 會員中心",meta:[{name:"description",content:"description"}]}),J(()=>{_.value=t.data.userData.avatar}),(b,s)=>{const i=q,m=A,z=M;return c(),w("section",K,[a(z,{onSubmit:N},{default:d(()=>[B.value?(c(),w("ul",Q,[e("li",W,[e("img",{src:_.value,alt:C.value.name,class:"w-[150px] h-[150px] rounded-[100px] mx-auto mt-10 mb-20 border-4 border-yellow-800 object-cover object-center"},null,8,X),e("div",{class:"bg-gray-900/50 rounded-[100px] w-[150px] h-[150px] flex items-center justify-center absolute inset-0 m-auto cursor-pointer",id:"changUserImg",onClick:s[0]||(s[0]=p=>n.value=!n.value)},ee),n.value?(c(),y(G,{key:0},{default:d(()=>[se,e("div",te,[ae,e("div",null,[a(i,{type:"url",name:"imgUrl",rules:{regex:/^(?=.*[A-Za-z])(?=.*\d)(https?:\/\/.*\.(?:png|jpg|jpeg|))$/},label:"網址",modelValue:u.value,"onUpdate:modelValue":s[1]||(s[1]=p=>u.value=p),class:"w-full h-[20px] px-2 py-4 text-black border border-gray-400/50"},null,8,["rules","modelValue"]),a(m,{name:"imgUrl",class:"text-red-500 mx-1 errors-msg"})])]),e("div",oe,[a(f,{type:"button",onClick:s[2]||(s[2]=p=>n.value=!n.value),class:"mr-10"},{default:d(()=>[g("取消")]),_:1}),a(f,{type:"button",onClick:P},{default:d(()=>[g("預覽")]),_:1})])]),_:1})):v("",!0)]),e("li",re,[le,e("p",null,D(k(t).data.userData.name),1)]),e("li",ne,[de,e("p",null,D(k(t).data.userData.email),1)]),e("li",ce,[ue,e("div",null,[a(i,{type:"password",name:"oldPassword",modelValue:S.value,"onUpdate:modelValue":s[3]||(s[3]=p=>S.value=p),label:"密碼",rules:I(),disabled:r.value,placeholder:"請輸入舊密碼",class:"w-full h-[20px] px-2 py-4 text-black border border-gray-400/50"},null,8,["modelValue","rules","disabled"]),a(m,{name:"oldPassword",class:"text-red-500 mx-1 errors-msg"})]),a(f,{type:"button",class:"w-[60px] h-[30px]",onClick:U},{default:d(()=>[g("更改")]),_:1})]),e("li",ie,[pe,e("div",null,[a(i,{type:"password",name:"newPassword",placeholder:"請輸入包含1個英文及8位數字密碼",label:"新密碼",rules:I(),disabled:r.value,class:"w-full h-[20px] px-2 py-4 text-black border border-gray-400/50"},null,8,["rules","disabled"]),a(m,{name:"newPassword",class:"text-red-500 mx-1 errors-msg"})])]),e("li",_e,[me,e("div",null,[a(i,{type:"password",name:"confirmation",placeholder:"請輸入包含1個英文及8位數字密碼",label:"確認新密碼",rules:{required:!r.value,confirmed:"@newPassword"},disabled:r.value,class:"w-full h-[20px] px-2 py-4 text-black border border-gray-400/50"},null,8,["rules","disabled"]),r.value?v("",!0):(c(),y(m,{key:0,name:"confirmation",class:"text-red-500 mx-1 errors-msg"}))])]),e("div",xe,[a(f,null,{default:d(()=>[g("送出更改")]),_:1})])])):v("",!0)]),_:1})])}}},fe=V(ge,[["__scopeId","data-v-afb455cb"]]),we={__name:"user",setup(o){return(t,r)=>(c(),y(fe))}};export{we as default};
