import{_ as V,o as c,c as w,P as z,p as P,e as $,a as e,u as E,r as g,n as v,q as F,b as a,w as d,x as y,d as x,v as b,t as D,E as k,H as A,I as J,B as M}from"./entry.5d0cda90.js";import{b as f}from"./button.fdead718.js";const O={},T=o=>(P("data-v-7d5cc6aa"),o=o(),$(),o),Z={class:"w-[90%] h-[280px] absolute inset-0 m-auto z-50 bg-gray-500/90"},H=T(()=>e("h3",{class:"bg-yellow-900 text-3xl text-center py-2"},"訊息",-1));function L(o,t){return c(),w("div",Z,[H,z(o.$slots,"default",{},void 0,!0)])}const R=V(O,[["render",L],["__scopeId","data-v-7d5cc6aa"]]);const l=o=>(P("data-v-3ad30f64"),o=o(),$(),o),G={class:"my-5"},K={key:0,class:"w-[600px] h-[calc(100vh-65px-145px)] mx-auto bg-gray-100 border-2 border-yellow-800 py-5"},Q={class:"relative",id:"userImg"},W=["src","alt"],X=l(()=>e("p",{class:"text-white font-bold"},"更換圖片",-1)),Y=[X],ee=l(()=>e("p",{class:"text-center mt-5 font-bold text-red-400"}," 請輸入含有【.jpg，.jpeg，.png】的圖片網址 ",-1)),se={class:"grid grid-cols-[100px,1fr,60px] mx-auto gap-2 mt-12"},te=l(()=>e("p",{class:"text-right"},"網址：",-1)),ae={class:"text-center mt-6"},oe={class:"grid grid-cols-[100px,1fr] mx-auto gap-2 mb-10 w-[80%]"},re=l(()=>e("p",{class:"text-right"},"姓名：",-1)),le={class:"grid grid-cols-[100px,1fr] mx-auto gap-2 mb-10 w-[80%]"},ne=l(()=>e("p",{class:"text-right"},"電子信箱：",-1)),de={class:"grid grid-cols-[100px,1fr,60px] mx-auto gap-2 mb-10 w-[80%]"},ce=l(()=>e("p",{class:"text-right"},"密碼：",-1)),ue={class:"grid grid-cols-[100px,1fr,60px] mx-auto gap-2 mb-10 w-[80%]"},ie=l(()=>e("p",{class:"text-right"},"新密碼：",-1)),pe={class:"grid grid-cols-[100px,1fr,60px] mx-auto gap-2 mb-10 w-[80%]"},_e=l(()=>e("p",{class:"text-right"},"確認新密碼：",-1)),me={class:"text-center mt-20"},ge={__name:"userInfo",setup(o){//! ----------宣告引入------------
const t=E();//!  ----------變數------------
const r=g(!0),n=g(!1),_=g(null),u=g("");//!  ----------功能------------
const j=()=>{u.value.length>10&&(_.value=u.value,u.value="",n.value=!n.value)},U=()=>{r.value=!r.value},I=()=>r.value?null:{regex:/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]+$/,required:"required",min:"8",max:"16"},B=v(()=>t.data.userData?t.data.userData:null),C=v(()=>!!t.data.userData),S=v(()=>r.value?"*".repeat(t.data.userData.password.length):null),N=h=>{//! 驗證舊密碼是否相同
h.oldPassword===t.data.userData.password||r.value?fetch(`https://api.escuelajs.co/api/v1/users/${t.data.userData.id}`,{method:"PUT",body:JSON.stringify({email:t.data.userData.email,name:t.data.userData.name,avatar:_.value,password:h.newPassword}),headers:{"Content-Type":"application/json"}}).then(s=>s.json()).then(async s=>{sessionStorage.getItem("userData")?sessionStorage.setItem("userData",JSON.stringify(s)):localStorage.setItem("userData",JSON.stringify(s)),await t.login(s),alert("更改成功"),window.location.reload()}).catch(s=>{console.log(s)}):alert("舊密碼錯誤")};return F(()=>{_.value=t.data.userData.avatar}),(h,s)=>{const i=A,m=J,q=M;return c(),w("section",G,[a(q,{onSubmit:N},{default:d(()=>[C.value?(c(),w("ul",K,[e("li",Q,[e("img",{src:_.value,alt:B.value.name,class:"w-[150px] h-[150px] rounded-[100px] mx-auto mt-10 mb-20 border-4 border-yellow-800 object-cover object-center"},null,8,W),e("div",{class:"bg-gray-900/50 rounded-[100px] w-[150px] h-[150px] flex items-center justify-center absolute inset-0 m-auto cursor-pointer",id:"changUserImg",onClick:s[0]||(s[0]=p=>n.value=!n.value)},Y),n.value?(c(),y(R,{key:0},{default:d(()=>[ee,e("div",se,[te,e("div",null,[a(i,{type:"url",name:"imgUrl",rules:{regex:/^(?=.*[A-Za-z])(?=.*\d)(https?:\/\/.*\.(?:png|jpg|jpeg|))$/},label:"網址",modelValue:u.value,"onUpdate:modelValue":s[1]||(s[1]=p=>u.value=p),class:"w-full h-[20px] px-2 py-4 text-black border border-gray-400/50"},null,8,["rules","modelValue"]),a(m,{name:"imgUrl",class:"text-red-500 mx-1 errors-msg"})])]),e("div",ae,[a(f,{type:"button",onClick:s[2]||(s[2]=p=>n.value=!n.value),class:"mr-10"},{default:d(()=>[x("取消")]),_:1}),a(f,{type:"button",onClick:j},{default:d(()=>[x("預覽")]),_:1})])]),_:1})):b("",!0)]),e("li",oe,[re,e("p",null,D(k(t).data.userData.name),1)]),e("li",le,[ne,e("p",null,D(k(t).data.userData.email),1)]),e("li",de,[ce,e("div",null,[a(i,{type:"password",name:"oldPassword",modelValue:S.value,"onUpdate:modelValue":s[3]||(s[3]=p=>S.value=p),label:"密碼",rules:I(),disabled:r.value,placeholder:"請輸入舊密碼",class:"w-full h-[20px] px-2 py-4 text-black border border-gray-400/50"},null,8,["modelValue","rules","disabled"]),a(m,{name:"oldPassword",class:"text-red-500 mx-1 errors-msg"})]),a(f,{type:"button",class:"w-[60px] h-[30px]",onClick:U},{default:d(()=>[x("更改")]),_:1})]),e("li",ue,[ie,e("div",null,[a(i,{type:"password",name:"newPassword",placeholder:"請輸入包含1個英文及8位數字密碼",label:"新密碼",rules:I(),disabled:r.value,class:"w-full h-[20px] px-2 py-4 text-black border border-gray-400/50"},null,8,["rules","disabled"]),a(m,{name:"newPassword",class:"text-red-500 mx-1 errors-msg"})])]),e("li",pe,[_e,e("div",null,[a(i,{type:"password",name:"confirmation",placeholder:"請輸入包含1個英文及8位數字密碼",label:"確認新密碼",rules:{required:!r.value,confirmed:"@newPassword"},disabled:r.value,class:"w-full h-[20px] px-2 py-4 text-black border border-gray-400/50"},null,8,["rules","disabled"]),r.value?b("",!0):(c(),y(m,{key:0,name:"confirmation",class:"text-red-500 mx-1 errors-msg"}))])]),e("div",me,[a(f,null,{default:d(()=>[x("送出更改")]),_:1})])])):b("",!0)]),_:1})])}}},xe=V(ge,[["__scopeId","data-v-3ad30f64"]]),ve={__name:"user",setup(o){return(t,r)=>(c(),y(xe))}};export{ve as default};
